#!/usr/bin/env bash


srcdir=$HOME/src/hypertable

usage_exit() {
  echo "Usage: htpkg [Options] <generator>..."
  echo ""
  echo "Options:"
  echo "  --srcdir <dir>        Hypertable source directory"
  echo ""
  exit $1
}

while [ "$1" != "${1##-}" ]; do
  case $1 in
    --srcdir)   srcdir=$2;      shift;;
    *)          usage_exit 1
  esac
  shift
done

gitrev=`git show --abbrev-commit | grep commit | head -1 | sed "s/[^\w]* //"`

echo ----
echo Building Revision: $gitrev
echo ----

cmake -DCMAKE_BUILD_TYPE=Release -DBUILD_SHARED_LIBS=ON -DCPACK_PACKAGE_VENDOR="K7 Computing" -DCPACK_PACKAGE_DESCRIPTION_SUMMARY="HyperTable DFS Storage packaged for Cyclozzo Platform" -DPACKAGE_THRIFTBROKER=0 -DCPACK_PACKAGE_VERSION_PATCH="cyclozzo.git.$gitrev"
cpack -G DEB

cmake -DCMAKE_BUILD_TYPE=Release -DBUILD_SHARED_LIBS=ON -DCPACK_PACKAGE_VENDOR="K7 Computing" -DCPACK_PACKAGE_DESCRIPTION_SUMMARY="HyperTable DFS Storage Thrift Broker packaged for Cyclozzo Platform" -DPACKAGE_THRIFTBROKER=1 -DCPACK_PACKAGE_VERSION_PATCH="cyclozzo.git.$gitrev"
cpack -G DEB

