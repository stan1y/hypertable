#!/usr/bin/env bash

build=Release
srcdir=$HOME/Source/hypertable
phpdir=$HOME/Source/thrift/lib/php/src

usage_exit() {
  echo "Usage: htpkg [Options] <generator>..."
  echo ""
  echo "Options:"
  echo "  --srcdir <dir>        Hypertable source directory"
  echo ""
  exit $1
}

while [ "$1" != "${1##-}" ]; do
  case $1 in
    --srcdir)   srcdir=$2;      shift;;
    *)          usage_exit 1
  esac
  shift
done

opts="-DCMAKE_BUILD_TYPE=Release -DBUILD_SHARED_LIBS=ON -DVERSION_ADD_COMMIT_SUFFIX=1"

for gen in "$@"; do
  cmake $opts -DPACKAGE_THRIFTBROKER= $srcdir
  cpack -G $gen
done
